# Fix: Hire View Experience Tab - Supabase to PostgreSQL Migration

## Problem
When clicking "Add Experience" in the admin panel's Hire View tab, the error showed:
```
Error adding experience
Validation failed: id: Invalid uuid
```

This was because the component was still using Supabase calls instead of the REST API with PostgreSQL.

## Root Causes
1. **Supabase Calls**: Component was using `.from("hire_experience").insert()` instead of REST API
2. **Invalid UUID Validation**: When creating new experiences, the temp id "temp" was being validated as a UUID
3. **PostgreSQL Missing**: Koyeb PostgreSQL was not configured in the component

## Solutions Applied

### 1. Replaced Supabase Insert with REST API (addExperience)
**Before:**
```typescript
const { data, error } = await db
  .from("hire_experience")
  .insert([newExperience])
  .select();
```

**After:**
```typescript
const response = await fetch(
  `${import.meta.env.VITE_API_URL}/db/hire_experience`,
  {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(newExperience),
  },
);

const data = await response.json();
```

### 2. Replaced Supabase Update with REST API (updateExperience)
Changed from `.update().eq().select()` to:
```typescript
const response = await fetch(
  `${import.meta.env.VITE_API_URL}/db/hire_experience/${expId}`,
  {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(updates),
  },
);
```

### 3. Replaced Supabase Delete with REST API (deleteExperience)
Changed from `.delete().eq()` to:
```typescript
const response = await fetch(
  `${import.meta.env.VITE_API_URL}/db/hire_experience/${expId}`,
  {
    method: "DELETE",
  },
);
```

### 4. Fixed UUID Validation
**Before:**
```typescript
validateExperienceData({ ...newExperience, id: "temp" });
```

**After:**
```typescript
validateExperienceData(newExperience); // Don't include temp id
```

The `id` field is optional in the schema and will be auto-generated by PostgreSQL.

## Files Modified
- `src/components/admin/HireViewEditor.tsx`
  - `addExperience()` function - ✅ Fixed
  - `updateExperience()` function - ✅ Fixed
  - `deleteExperience()` function - ✅ Fixed

## Testing
To verify the fix works:

1. Go to Admin Panel → Hire View → Experience tab
2. Click "Add Experience"
3. You should see no error, and a new experience row should be added
4. Edit the experience fields (company, position, etc.)
5. Delete the experience by clicking trash icon

All operations should now work properly with PostgreSQL via the REST API.

## Notes
⚠️ **Remaining Supabase Calls**:
The following still need to be migrated (not part of this fix):
- `fetchHireViewData()` - Still uses Supabase `.from()` calls
- Other skill and contact field operations
- Database connection test function

These should be migrated in a future update to fully remove Supabase dependency.

## Environment Variables Used
- `VITE_API_URL`: Set in `.env` to point to backend API (default: `/api` in production)
- Database credentials in `.env`: `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`

---
**Status**: ✅ Experience Tab - FIXED
**Date**: October 25, 2025
